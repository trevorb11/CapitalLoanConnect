<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MQNM8WDQ');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title>Apply for Business Financing - Today Capital Group</title>
    <meta name="description" content="Apply for business financing with Today Capital Group. Fast, simple application process with competitive rates for your business funding needs.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CR5Q49Y3J5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CR5Q49Y3J5');

      // Google Ads Enhanced Conversions setup
      // IMPORTANT: Replace AW-XXXXXXXXX with your actual Google Ads Conversion ID
      // and AW-XXXXXXXXX/YYYYYYYYYY with your full conversion send_to value
      gtag('config', 'AW-XXXXXXXXX', {
        allow_enhanced_conversions: true
      });

      // Custom event tracking functions
      window.trackEvent = function(eventName, eventParams) {
        gtag('event', eventName, eventParams);
      };
      
      // Track full application submission
      window.trackApplicationSubmitted = function(params) {
        gtag('event', 'application_submitted', {
          event_category: 'form_submission',
          event_label: 'Full Application',
          application_type: params.applicationType || 'full_application',
          agent_code: params.agentCode || 'direct',
          ...params
        });
      };
      
      // Track intake form (quiz) submission
      window.trackIntakeFormSubmitted = function(params) {
        gtag('event', 'intake_form_submitted', {
          event_category: 'form_submission',
          event_label: 'Intake Quiz',
          requested_amount: params.requestedAmount || '',
          credit_score: params.creditScore || '',
          ...params
        });
      };
      
      // Track form step completion
      window.trackFormStepCompleted = function(formType, stepNumber, stepName) {
        gtag('event', 'form_step_completed', {
          event_category: 'form_progress',
          event_label: formType,
          form_type: formType,
          step_number: stepNumber,
          step_name: stepName
        });
      };
      
      // Track page views (enhanced)
      window.trackPageView = function(pagePath, pageTitle) {
        gtag('event', 'page_view', {
          page_path: pagePath,
          page_title: pageTitle
        });
      };
      
      // Track bank connection via Plaid
      window.trackBankConnected = function(institutionName) {
        gtag('event', 'bank_connected', {
          event_category: 'plaid_integration',
          event_label: institutionName,
          institution_name: institutionName
        });
      };
      
      // Track bank statement upload
      window.trackBankStatementUploaded = function(fileCount) {
        gtag('event', 'bank_statement_uploaded', {
          event_category: 'document_upload',
          event_label: 'Bank Statement',
          file_count: fileCount
        });
      };
      
      // Track form abandonment (when user leaves without completing)
      window.trackFormAbandonment = function(formType, lastStep) {
        gtag('event', 'form_abandoned', {
          event_category: 'form_abandonment',
          event_label: formType,
          form_type: formType,
          last_step: lastStep
        });
      };
      
      // Track close_convert_lead event (traffic from intake quiz or get-qualified page to main app)
      window.trackCloseConvertLead = function(source) {
        gtag('event', 'close_convert_lead', {
          event_category: 'conversion',
          event_label: source || 'direct',
          traffic_source: source || 'direct'
        });
      };

      // Google Ads Enhanced Conversion - fires ONLY for qualified intake leads (revenue >= $10k/month)
      // This sets enhanced_conversion_data on the window for Google to read,
      // then fires the conversion event.
      // IMPORTANT: Replace 'AW-XXXXXXXXX/YYYYYYYYYY' with your actual send_to value from Google Ads.
      window.trackQualifiedIntakeConversion = function(params) {
        // Split full name into first and last for enhanced conversions
        var nameParts = (params.fullName || '').trim().split(/\s+/);
        var firstName = nameParts[0] || '';
        var lastName = nameParts.slice(1).join(' ') || '';

        // Set enhanced conversion data as JavaScript variables on the window
        // These are the variables Google Ads will read for Enhanced Conversions
        window.enhanced_conversion_data = {
          email: params.email || '',
          phone_number: params.phone ? '+1' + params.phone.replace(/\D/g, '') : '',
          first_name: firstName,
          last_name: lastName
        };

        // Fire the Google Ads conversion event
        gtag('event', 'conversion', {
          send_to: 'AW-XXXXXXXXX/YYYYYYYYYY',
          transport_type: 'beacon'
        });

        // Also fire a GA4 event for reporting
        gtag('event', 'qualified_intake_conversion', {
          event_category: 'conversion',
          event_label: 'Qualified Intake Lead',
          monthly_revenue: params.monthlyRevenue || '',
          requested_amount: params.requestedAmount || '',
          industry: params.industry || '',
          credit_score: params.creditScore || '',
          transport_type: 'beacon'
        });
      };
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
